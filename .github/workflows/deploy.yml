name: Auto Deploy to VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploying to VPS via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USERNAME }}
          key: ${{ secrets.VPS_SSH_KEY }}
          port: 22 # Default SSH port
          script: |
            # Masuk ke folder project (ganti sesuai path di VPS)
            cd ${{ secrets.VPS_PROJECT_PATH }}
            
            # Tarik update terbaru
            git pull origin main
            
            # Install dependencies (opsional, jika ada update composer)
            # composer install --no-interaction --prefer-dist --optimize-autoloader
            
            # Jalankan migrasi database otomatis
            php artisan migrate --force
            
            # Bersihkan cache agar perubahan config terbaca
            php artisan optimize:clear
            php artisan config:clear
            
            echo "Deployment Completed Successfully!"
